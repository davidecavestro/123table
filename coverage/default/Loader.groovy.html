<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Loader.groovy</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Coverage Report</a> &gt; <a href="index.source.html" class="el_package">default</a> &gt; <span class="el_source">Loader.groovy</span></div><h1>Loader.groovy</h1><pre class="source lang-java linenums">class Loader {

    def sideLoadDrivers (def driversDir) {
<span class="fc" id="L4">        def drivers = new File(driversDir).listFiles(</span>
            [accept: { it.name.endsWith('.jar') }] as FileFilter
        ).collect { def jar -&gt;
        println &quot;Processing jar: ${jar}&quot;
            def jarFile = new java.util.jar.JarFile(jar)
            def svcFile = jarFile.getEntry('META-INF/services/java.sql.Driver')
            // pick the first non empty line
            def driverClassName = svcFile ? jarFile.getInputStream(svcFile).readLines().find { it.trim() }?.trim() : null

            [driver: driverClassName, url: jar.toURI().toURL()]
        }

<span class="fc" id="L16">        def driversClassLoader = new URLClassLoader(</span>
            drivers*.url as URL[],
            this.class.classLoader
        )
<span class="fc" id="L20">        Thread.currentThread().setContextClassLoader(driversClassLoader)</span>

<span class="fc" id="L22">        drivers.findAll { it.driver }*.driver.each {</span>
            def driverClass = driversClassLoader.loadClass(it)
            println &quot;Registering driver: ${ it }&quot;
            def driverShim = new Wrapper(wrapped: driverClass.newInstance())

            java.sql.DriverManager.registerDriver(driverShim)
        }
    }

    /**
     * Parse first input line as if thewy were args from main
     */
    def getArgs(InputStream input) {
<span class="fc" id="L35">        def line = input.newReader().readLines().first</span>
<span class="fc" id="L36">        return (line =~ /&quot;[^&quot;]*&quot;|'[^']*'|[^\s]+/).collect { </span>
            it.replaceAll(/^[&quot;']|[&quot;']$/,'')
        }.toArray()
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>